---
import Layout from '~/layouts/Layout.astro';

const categories = ['01. Grace & Mila', '02. Identités visuelles', '03. Photographies'];

const projects = [
  {
    id: 1,
    category: categories[0],
    preview_img: './assets/1.jpg',
    preview_img_alt: 'Une image',
    preview_titles: ['Projets', 'prints'],
    preview_description: 'la description est écrite en markdown.',
    content_author: 'Par Morgane Cerceau',
    content_description:
      'Andesite (/ˈændəzaɪt/) is a volcanic rock of intermediate composition. In a general sense, it is the intermediate type between silica-poor basalt and silica-rich rhyolite.',
    content_thumbs: ['./assets/1_1.jpg', './assets/1_2.jpg', './assets/1_3.jpg', './assets/1_4.jpg'],
    thumbs_alt: 'Vignette',
  },
  {
    id: 2,
    category: categories[1],
    preview_img: './assets/2.jpg',
    preview_img_alt: 'Une image',
    preview_titles: ['Projets', 'digitaux'],
    preview_description: 'la description est écrite en markdown.',
    content_author: 'Par Morgane Cerceau',
    content_description:
      'Andesite (/ˈændəzaɪt/) is a volcanic rock of intermediate composition. In a general sense, it is the intermediate type between silica-poor basalt and silica-rich rhyolite.',
    content_thumbs: ['./assets/2_1.jpg', './assets/2_2.jpg', './assets/2_3.jpg', './assets/2_4.jpg'],
    thumbs_alt: 'Vignette',
  },
  {
    id: 3,
    category: categories[2],
    preview_img: './assets/3.jpg',
    preview_img_alt: 'Une image',
    preview_titles: ['Projets', 'digitaux'],
    preview_description: 'la description est écrite en markdown.',
    content_author: 'Par Morgane Cerceau',
    content_description:
      'Andesite (/ˈændəzaɪt/) is a volcanic rock of intermediate composition. In a general sense, it is the intermediate type between silica-poor basalt and silica-rich rhyolite.',
    content_thumbs: ['./assets/3_1.jpg', './assets/3_2.jpg', './assets/3_3.jpg', './assets/3_4.jpg'],
    thumbs_alt: 'Vignette',
  },

  {
    id: 4,
    category: categories[0],
    preview_img: './assets/4.jpg',
    preview_img_alt: 'Une image',
    preview_titles: ['Projets', 'prints'],
    preview_description: 'la description est écrite en markdown.',
    content_author: 'Par Morgane Cerceau',
    content_description:
      'Andesite (/ˈændəzaɪt/) is a volcanic rock of intermediate composition. In a general sense, it is the intermediate type between silica-poor basalt and silica-rich rhyolite.',
    content_thumbs: ['./assets/4_1.jpg', './assets/4_2.jpg', './assets/4_3.jpg', './assets/4_4.jpg'],
    thumbs_alt: 'Vignette',
  },
  {
    id: 5,
    category: categories[1],
    preview_img: './assets/5.jpg',
    preview_img_alt: 'Une image',
    preview_titles: ['Projets', 'digitaux'],
    preview_description: 'la description est écrite en markdown.',
    content_author: 'Par Morgane Cerceau',
    content_description:
      'Andesite (/ˈændəzaɪt/) is a volcanic rock of intermediate composition. In a general sense, it is the intermediate type between silica-poor basalt and silica-rich rhyolite.',
    content_thumbs: ['./assets/5_1.jpg', './assets/5_2.jpg', './assets/5_3.jpg', './assets/5_4.jpg'],
    thumbs_alt: 'Vignette',
  },
  {
    id: 6,
    category: categories[2],
    preview_img: './assets/6.jpg',
    preview_img_alt: 'Une image',
    preview_titles: ['Projets', 'digitaux'],
    preview_description: 'la description est écrite en markdown.',
    content_author: 'Par Morgane Cerceau',
    content_description:
      'Andesite (/ˈændəzaɪt/) is a volcanic rock of intermediate composition. In a general sense, it is the intermediate type between silica-poor basalt and silica-rich rhyolite.',
    content_thumbs: ['./assets/6_1.jpg', './assets/6_2.jpg', './assets/6_3.jpg', './assets/6_4.jpg'],
    thumbs_alt: 'Vignette',
  },
];
---

<Layout
  title="Mon travail | Morgane Cerceau"
  description="Découvrez mes projets autour de la direction artistique, du print et des identités visuelles."
>
  <main class="grid">
    <div class="frame">
      <div class="frame__title">
        <h1 class="frame__title-main"></h1>
      </div>
    </div>
    <section class="preview-wrap">
      {
        projects.map((project) => (
          <div class="preview" data-category={project.category}>
            <div class="preview__img-wrap">
              <div class="preview__img">
                <div class="preview__img-inner" style={`background-image: url(${project.preview_img})`} />
              </div>
            </div>
            <div class="preview__title">
              <h2 class="preview__title-main">
                {project.preview_titles.map((title) => (
                  <span class="oh">
                    <span class="oh__inner">{title}</span>
                  </span>
                ))}
              </h2>
              <p class="preview__desc">{project.preview_description}</p>
            </div>
          </div>
        ))
      }
    </section>
    <section class="content-wrap">
      {
        projects.map((project) => (
          <div class="content">
            <div class="content__group">
              <div class="content__title">
                {project.preview_titles.map((title) => (
                  <span class="oh">
                    <span class="oh__inner">{title}</span>
                  </span>
                ))}
              </div>
              <div class="content__meta oh">
                <span class="oh__inner">{project.content_author}</span>
              </div>
              <div class="content__text">{project.content_description}</div>
            </div>
            <div class="content__thumbs">
              {project.content_thumbs.map((thumb) => (
                <div class="content__thumbs-item" style={{ backgroundImage: `url(${thumb})` }} />
              ))}
            </div>
          </div>
        ))
      }
      <button class="unbutton action action--back">
        <svg width="25px" height="25px" viewBox="0 0 25 25">
          <path d="M24 12.001H2.914l5.294-5.295-.707-.707L1 12.501l6.5 6.5.707-.707-5.293-5.293H24v-1z"></path>
        </svg>
        <span>Retour</span>
      </button>
    </section>
  </main>
</Layout>

<script>
  import '~/scripts/index.js';

  let visibleCategory = '';

  const updateVisibleCategory = () => {
    const previews = document.querySelectorAll('.preview-wrap .preview') as NodeListOf<HTMLDivElement>;
    let newVisibleCategory = null;

    previews.forEach((preview) => {
      const rect = preview.getBoundingClientRect();
      if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
        const projectCategory = preview.dataset.category;
        if (projectCategory) {
          newVisibleCategory = projectCategory;
        }
      }
    });

    if (newVisibleCategory !== null && newVisibleCategory !== visibleCategory) {
      visibleCategory = newVisibleCategory;
      updateFramePrevText();
    }
  };

  const updateFramePrevText = () => {
    const frameTitle = document.querySelector('.frame__title-main');
    if (frameTitle) {
      frameTitle.textContent = visibleCategory;
    }
  };

  document.addEventListener('scroll', updateVisibleCategory);
  document.addEventListener('DOMContentLoaded', updateVisibleCategory);
</script>

<style>
  body.content-open {
    overflow: hidden;
    height: 100vh;
  }

  body.content-open .preview-wrap {
    pointer-events: none;
  }

  .grid {
    position: relative;
    display: grid;
    grid-template-areas: 'frame' 'page';
  }

  .frame {
    grid-area: frame;
    padding: 1.5rem 2rem;
    z-index: 1000;
    background: var(--color-bg);
    justify-content: center;
    align-items: center;
    text-transform: uppercase;
    grid-row-gap: 5vh;
    display: none;
  }

  .frame__title {
    grid-area: title;
    display: flex;
  }

  .frame__title-main {
    color: var(--color-text);
    font-size: 1.5rem;
    margin: 0;
    font-weight: normal;
    line-height: 1;
    align-self: center;
    text-align: right;
  }

  .frame__title-back {
    position: relative;
    display: flex;
    align-items: flex-end;
    margin-bottom: 0.15rem;
  }

  .frame__title-back span {
    display: none;
  }

  .frame__title-back svg {
    fill: currentColor;
  }

  .frame__prev {
    grid-area: prev;
  }

  .oh {
    position: relative;
    overflow: hidden;
  }

  .oh__inner {
    will-change: transform;
    display: inline-block;
  }

  .unbutton {
    background: none;
    border: 0;
    padding: 0;
    margin: 0;
    font: inherit;
    fill: currentColor;
    cursor: pointer;
    color: inherit;
    display: flex;
    align-items: center;
  }

  .unbutton:focus {
    outline: none;
  }

  .unbutton span:first-child {
    margin-right: 1rem;
  }

  .unbutton span:last-child {
    margin-left: 1rem;
  }

  .preview-wrap {
    grid-area: page;
    padding: 0 2rem 3rem;
    position: relative;
    z-index: 100;
  }

  .preview {
    min-height: 400px;
    padding: 3rem 0 0;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 100%;
    grid-template-rows: 100%;
    will-change: transform;
  }

  .preview__img-wrap {
    grid-area: 1 / 1 / -1 / -1;
    cursor: pointer;
  }

  .preview__img {
    width: 100%;
    height: 100%;
    overflow: hidden;
    position: relative;
  }

  .preview__img-inner {
    width: 100%;
    height: 100%;
    background-size: 150%;
    background-position: 0% 0%;
    background-repeat: no-repeat;
  }

  .content__meta {
    margin-bottom: 2rem;
    color: var(--color-text-alt);
  }

  .preview__title {
    text-align: center;
    align-self: center;
    justify-self: center;
    grid-area: 1 / 1 / -1 / -1;
    position: relative;
    transform: translate3d(0, 50%, 0);
    pointer-events: none;
    color: #fff;
  }

  .preview__title-main {
    line-height: 1.2;
    margin: 0;
    font-weight: normal;
    font-size: clamp(2rem, 10vw, 8rem);
    font-family: scotch-display, sans-serif;
    font-weight: 300;
  }

  .preview__title-main > span {
    display: block;
  }

  .preview__title-main > span:last-child {
    display: block;
    padding: 0 1rem;
    transform: translateY(-33%);
    font-family: scotch-display, sans-serif;
    font-weight: 500;
    font-style: italic;
  }

  .preview__desc {
    margin: 0 auto;
    max-width: 400px;
    text-transform: uppercase;
    line-height: 1.2;
  }

  .content-wrap {
    position: -webkit-sticky; /* Safari */
    position: sticky;
    top: 0;
    grid-area: page;
    height: 100vh;
    overflow: hidden;
    display: grid;
    grid-template-areas:
      'back back'
      'content content';
    grid-template-rows: auto 1fr;
    pointer-events: none;
    padding: 2rem;
  }

  .action {
    visibility: hidden;
    pointer-events: none;
    opacity: 0;
  }

  body.content-open .action {
    visibility: visible;
    pointer-events: auto;
  }

  .action svg {
    width: 2em;
    height: 2em;
  }

  .action--back {
    justify-self: start;
    grid-area: back;
    padding: 1rem 0;
  }

  .action span {
    text-transform: uppercase;
  }

  .content {
    grid-area: content;
    grid-row: 2 / span 2;
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    pointer-events: none;
    opacity: 0;
    display: grid;
    grid-gap: 2vw;
    grid-template-columns: 100%;
    grid-template-areas:
      'img'
      'thumbs'
      'text';
    grid-template-rows: 20vh min-content auto;
  }

  .content--current {
    position: relative;
    pointer-events: auto;
    opacity: 1;
  }

  .content__group {
    grid-area: text;
  }

  .content__title {
    font-family: scotch-display, sans-serif;
    font-weight: 400;
    font-size: clamp(3rem, 6.5vw, 5.5rem);
  }

  .content__title span {
    display: block;
  }

  .content__title > span:last-child {
    transform: translateY(-25%);
    font-family: scotch-display, sans-serif;
    font-weight: 500;
    font-style: italic;
    padding: 0 0 0 0.75rem;
  }

  .content .preview__img {
    grid-area: img;
  }

  .content__thumbs {
    grid-area: thumbs;
    display: grid;
    grid-auto-columns: auto;
    grid-auto-flow: column;
    grid-gap: 2vw;
    justify-content: start;
  }

  .content__thumbs-item {
    width: 50px;
    aspect-ratio: 1.5;
  }

  .content__thumbs-item:hover {
    cursor: not-allowed;
  }

  .hidden {
    opacity: 0;
    pointer-events: none;
  }

  @media screen and (min-width: 53em) {
    .grid {
      grid-template-areas: 'frame page';
      grid-template-columns: auto 1fr;
    }
    .frame {
      position: -webkit-sticky; /* Safari */
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      opacity: 0.5;
      padding: 2rem;
    }

    .frame__title,
    .frame__prev,
    #cdawrap {
      justify-self: start;
      -webkit-writing-mode: vertical-rl;
      writing-mode: vertical-rl;
      transform: rotate(180deg);
    }

    body #cdawrap {
      justify-self: start;
    }

    .preview {
      min-height: 90vh;
    }
    .preview__desc {
      margin: -2.5rem auto 0;
    }
    .content {
      grid-template-columns: 60% 1fr;
      grid-template-areas:
        '... ...'
        'img text'
        'thumbs text'
        '... ...';
      grid-template-rows: 2rem 1fr auto 1rem;
    }
    .content__thumbs-item {
      width: 100px;
    }
    .content__text {
      max-width: 400px;
    }
  }
</style>
